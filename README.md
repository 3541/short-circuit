# Short Circuit
[![builds.sr.ht status](https://builds.sr.ht/~_3541/short-circuit/commits/.build.yml.svg)](https://builds.sr.ht/~_3541/short-circuit/commits/.build.yml?)

A lightweight and performant web server for Linux, built on top of io_uring. Capable of ~~60,000~~
~~80,000~~ ~~120,000~~ ~~135,000 requests per second on static files~~. Suffice it to say, it is
fast, and getting faster. Actual, more rigorous benchmarks will come once the project gets closer to
completion.

[io_uring](https://kernel.dk/io_uring.pdf?source=techstories.org) is a new asynchronous I/O system
on Linux which offers a significant performance advantage (and, subjectively, a much nicer
interface) over its competitors (POSIX `aio`, `epoll`, etc...).

## Building
Dependencies:
* A C compiler supporting C11.
* A C++ compiler supporting C++11.
* CMake 3.9 or later.
* [liburing](https://github.com/axboe/liburing).
* Linux 5.7 or later.

To build, create a build directory and change into it. Then run `cmake ..
[-DCMAKE_BUILD_TYPE=<Debug|Release>]` to set up the build system, and `cmake --build .` to build the
project. This produces a binary `sc`, which can be run directly. By default, the server listens on
port `8000`.

To run the test suite, invoke the `sc_check` target.

Note: on most Linux distributions, you may see warnings about the locked memory and open file
resource limits. See [here](#queue-size) for more information.

## Notes and disclaimer
This is _very_ new software, which is nowhere near feature complete, let alone stable. There are
critical bugs, known and unknown. At this time it should not under any circumstances be used in
production or for anything which matters even a little bit.

### Queue size
On most distributions, the locked memory limit is too low to open an `io_uring` queue of the size
that Short Circuit does by default. This can be fixed either (preferably) by increasing this limit
(usually in `/etc/security/limits.conf`), or by lowering `URING_ENTRIES` in `config.h`. It probably
needs to be at least halved to work with the default limit.

### Open file limit
To serve static files, Short Circuit uses `IO_URING_OP_PIPE`. For performance purposes, these pipes
are cached across requests. As a result, under high load (particularly when it is generated by many
simultaneous connections), many systems will hit the open file limit. This can be fixed by raising
the open file limit, or by decreasing `CONNECTION_POOL_SIZE` in `config.h`. The former can be done
with `ulimit -n [new value]` (since the soft limit is often significantly lower than the hard
limit), or in `/etc/security/limits.conf` for a permanent change. A good number is a bit over three
times the maximum expected number of concurrent connections, since each connection requires an open
file for the socket and two for the pipe.

## Licensing

Short Circuit is licensed under the GNU Affero GPL, the terms of which are described
[here](https://github.com/3541/short-circuit/blob/trunk/LICENSE).

Short Circuit depends on the following other projects:

### liba3
[liba3](https://github.com/3541/liba3) is licensed under the [3-clause BSD
license](https://github.com/3541/liba3/blob/trunk/LICENSE).

`liba3` also links with and otherwise uses other software projects, as detailed
[here](https://github.com/3541/liba3/blob/trunk/README.md#licensing).

### liburing
[liburing](https://github.com/axboe/liburing) is licensed under the [MIT
license](https://github.com/axboe/liburing/blob/master/LICENSE).
